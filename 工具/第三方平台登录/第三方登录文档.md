## Facebook 第三方登录

[官方文档](https://developers.facebook.com/docs/facebook-login/web)

准备工作：

- 一个 [Facebook 开发者帐户](https://developers.facebook.com/apps/)
- 一个[已注册的 Facebook 应用](https://developers.facebook.com/docs/apps#register)，且需配置好基本设置
- [JavaScript Facebook SDK](https://developers.facebook.com/docs/javascript)

操作步骤

1. 为应用添加 `facebook登录`
   ![fb_guide_00](.\fb_guide_00.png)

2. 获取官方提供的案件代码, 引入 `facebook-sdk` (appId字段必须带上, 在未登录开发者状态之前, 默认不存在该字段)
   ![fb_guide_01](.\fb_guide_01.png)

3. 自定义点击事件登录及获取用户信息 [头像获取](https://www.itranslater.com/qa/details/2325728981598864384)

   ```js
   // 点击触发facebook登录
   function fbLogin() {
       FB.login(function (response) {
           console.log('response', response);
           if (response.status === 'connected') {   // Logged into your webpage and Facebook.
               fbGetInfo();
           } else {                                 // Not logged into your webpage or we are unable to tell.
   			
           }
       })
   }
   
   // 获取用户的 id 和 用户昵称
   function fbGetInfo() {
       FB.api('/me', function (response) {
           console.log('Successful login for: ', response);
       });
   }
   
   // 将获取到的 id 拼接到 {facebookId} 上，即可获取头像
   // https://graph.facebook.com/{facebookId}/picture?type=normal
   
   ```

## Instagram 第三方登录

1. 创建 facebook app 应用

2. 为应用添加 `Instagram Basic Display` 产品
   ![ins_gudie_00](.\ins_gudie_00.png)

3. 获取`code` 查询字符串参数 [见官网文档步骤](https://developers.facebook.com/docs/instagram-basic-display-api/guides/getting-access-tokens-and-permissions)
   A. 获取授权（为前端链接跳转）
   注意：**测试阶段 **先添加测试者, 不然会返回 `Insufficient developer role`
   ![ins_gudie_01](.\ins_gudie_01.png)

   ```js
   function redirectToInstagram() {
       // client_id: Instagram 应用编号
    	// redirect_uri: 用户允许或拒绝权限请求后将用户重定向到的 URI
       // response_type: 将此值设置为 code
       // scope: [user_profile,user_media] 要向应用用户请求的权限的列表，列表以逗号分隔，或者以空格分隔且以网址编码。user_profile 为必需项。
       window.location.replace(`https://api.instagram.com/oauth/authorize
           ?client_id=849866439009438
           &redirect_uri=https://tstatic.ssl.jimingkeji.com.cn/javis-test/thirdPathLogin/test.html
           &scope=user_profile,user_media
           &response_type=code`
       );
   }
   
   // code为一次性代码, 有效期为 1小时
   // 成功的授权重定向示例 (#_为多余代码，需要去掉)
   // https://tstatic.ssl.jimingkeji.com.cn/javis-test/thirdPathLogin/test.html?code=AQAp6yPTRl-_ZUf3adA3yx4JFDRBKko3fXMK4gt1WnULfL2WaFtI9DicrWYYlcDyBpf5KgTdNYAApUMKgT7_1YSiTRHEWLvjYsBZ0fzZ31nalrJ0QXZ6jN4XS36zIrXoWM5MYMCxUwiUiyMGzgETYCpgVyuRXlRdAHZp6USfA0tLOExvfKOZhbfqRNkA8rVXr9SA65ivYAmEwNMQwMCFmGAyaNHYb7a8lXD3Bo6Fp5VOBg#_
   ```

   B. 使用 `code` 交换 `短期access_token`

   ```code
   POST https://api.instagram.com/oauth/access_token
   ```

   ![ins_gudie_02](.\ins_gudie_02.png)

4. 获取用户信息 [见官方文档](https://developers.facebook.com/docs/instagram-basic-display-api/reference) （暂未找到获取头像方法）
   ![ins_gudie_03](.\ins_gudie_03.png)

   ![ins_gudie_04](.\ins_gudie_04.png)

